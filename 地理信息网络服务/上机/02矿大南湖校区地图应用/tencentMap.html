<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>创建地图</title>

    <link rel="stylesheet" type="text/css" href="css/Map.css">

</head>
<script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=PLWBZ-X4XLD-RDR4G-HBVSI-XRKK2-HEBDC"></script>
<script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&libraries=service&key=PLWBZ-X4XLD-RDR4G-HBVSI-XRKK2-HEBDC"></script>
<!--<script src="js/Map.js"></script>-->

<body>
    <div id="container"></div>
    <div id="panel">
<!--        <input type="button" class="btn" value="try" onclick="initMap()"></input>-->
        <p>第一种方式：输入关键字并按下搜索，将在南湖校区中搜索相关地点。</p>
        <label for='keyword'>查询：</label><input id='keyword' type="text" value='超市'>

<!--        <select id="location1">-->
<!--            <option value="超市">超市</option>-->
<!--            <option value="博学楼">博学楼</option>-->
<!--        </select>-->
        <input id="search" type="button" class="btn" value="搜索" onclick="searchByKeyword()" />
        <p>双击或滑动鼠标滚轮可放大，单击结果可以显示详细信息。</p>

    </div>
</body>
<script type="text/javascript">
    // 用经纬度定义中心点
    var centerNanHu = new TMap.LatLng(34.215,117.145);
    // 定义地图
    var mapNanHu = new TMap.Map('container', {
        zoom: 15.5,
        center: centerNanHu,
    });
    // 定义一个地点搜索类
    var search = new TMap.service.Search({ pageSize: 10 });
    // 点聚合
    var markers = new TMap.MultiMarker({
        map: mapNanHu,
        geometries: [],
    });
    // 窗体
    var infoWindowList = Array(10);

    function searchByKeyword() {
        infoWindowList.forEach((infoWindow) => {
            infoWindow.close();
        });
        infoWindowList.length = 0;
        // 清除已有点
        markers.setGeometries([]);
        // 在地图显示范围内以给定的关键字搜索地点
        search
            .searchNearby(
                {
                    keyword:document.getElementById('keyword').value,
                    center:centerNanHu,
                    radius:700,
                    autoExtend:false,
                }
            )
            .then((result) => {
                result.data.forEach((item, index) => {
                    var geometries = markers.getGeometries();
                    var infoWindow = new TMap.InfoWindow({
                        map: mapNanHu,
                        position: item.location,
                        content: `<h3>${item.title}</h3><p>地址：${item.address}</p>`,
                        offset: { x: 0, y: -50 },
                    }); // 新增信息窗体显示地标的名称与地址、电话等信息
                    infoWindow.close();
                    infoWindowList[index] = infoWindow;
                    geometries.push({
                        id: String(index), // 点标注数据数组
                        position: item.location,
                    });
                    markers.updateGeometries(geometries); // 绘制地点标注
                    markers.on('click', (e) => {
                        infoWindowList[Number(e.geometry.id)].open();
                    }); // 点击标注显示信息窗体
                });
            });
    }

</script>
</html>